{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://impresso.github.io/impresso-schemas/json/canonical/audio_record.schema.json",
    "title": "Audio Record",
    "description": "Physical representation of a radio broadcast audio record as recognized by a given ASR engine.",
    "type": "object",
    "properties": {
        "id": {
            "type": "string",
            "description": "Canonical ID of the radio broadcast's audio record (e.g. [INA alias]-1940-07-22-a-r0001)",
            "pattern": "^[A-Za-z][A-Za-z0-9_]*-\\d{4}-\\d{2}-\\d{2}-[a-z]{1,3}-r[0-9]{4}$"
        },
        "iiif_base_uri": {
            "type": "string",
            "description": "Base of the IIIF URI of the audio record. Exact format to be defined."
        },
        "stt": {
            "type": "string",
            "description": "Audio recording's start time (of day) if exists or is available (00:00:00 otherwise), in HH:MM:SS format.",
            "pattern": "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
        },
        "dur": {
            "type": "string",
            "description": "Duration of the entire audio boradcast, in HH:MM:SS format.",
            "pattern": "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
        },
        "st": {
            "type": "string",
            "description": "Type of media source. Should be a value the impresso-essentials.utils SourceType enum.",
            "const": "radio_broadcast"
        },
        "sm": {
            "type": "string",
            "description": "Source medium, format in which the media was originally produced.",
            "const": "audio"
        },
        "cdt": {
            "type": "string",
            "description": "Creation date timestamp (of the JSON file)."
        },
        "ts": {
            "type": "string",
            "description": "Creation date timestamp (in '%Y-%m-%dT%H:%M:%SZ' format)."
        },
        "s": {
            "type": "array",
            "description": "List of audio broadcast sections.",
            "items": {
                "type": "object",
                "description": "Section of audio broadcast (equivalent of page region).",
                "properties": {
                    "tc": {
                        "description": "Time coordinates of the section.",
                        "$ref": "#/$defs/time_coordinates"
                    },
                    "u": {
                        "type": "array",
                        "description": "Speech utterances (consecutive same-speaker speech segments).",
                        "items": {
                            "type": "object",
                            "properties": {
                                "tc": {
                                    "description": "Time coordinates of the utterance.",
                                    "$ref": "#/$defs/time_coordinates"
                                },
                                "speaker": {
                                    "type": "string",
                                    "description": "Speaker id or name for this utterance."
                                },
                                "ss": {
                                    "type": "array",
                                    "description": "list of speech segments.",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "tc": {
                                                "description": "Time coordinates of the speech segment.",
                                                "$ref": "#/$defs/time_coordinates"
                                            },
                                            "t": {
                                                "type": "array",
                                                "description": "Speech tokens (as detected by the ASR engine).",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "tc": {
                                                            "description": "Time coordinates of the speech token.",
                                                            "$ref": "#/$defs/time_coordinates"
                                                        },
                                                        "tx": {
                                                            "type": "string",
                                                            "description": "Token surface form."
                                                        }
                                                    },
                                                    "required": [
                                                        "tc",
                                                        "tx"
                                                    ]
                                                }
                                            }
                                        },
                                        "required": [
                                            "tc",
                                            "t"
                                        ]
                                    }
                                }
                            },
                            "required": [
                                "tc",
                                "ss"
                            ]
                        }
                    },
                    "pOf": {
                        "type": "string",
                        "description": "The canonical ID of the content item to which the utterance belongs."
                    }
                },
                "required": [
                    "tc",
                    "u"
                ]
            }
        }
    },
    "$defs": {
        "time_coordinates": {
            "type": "array",
            "description": "Coordinates of audio-segment in the format (start-time, duration), each in seconds.",
            "minItems": 2,
            "maxItems": 2,
            "items": {
                "type": [
                    "number"
                ]
            }
        }
    },
    "dependentRequired": {
        "sm": [
            "st"
        ],
        "st": [
            "sm"
        ]
    },
    "required": [
        "id",
        "s",
        "stt",
        "dur",
        "iiif_base_uri"
    ],
    "oneOf": [
        {
            "required": [
                "ts"
            ]
        },
        {
            "required": [
                "cdt"
            ]
        }
    ]
}