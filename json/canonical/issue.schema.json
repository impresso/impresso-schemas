{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://impresso.github.io/impresso-schemas/json/canonical/issue.schema.json",
    "description": "Logical representation of the contents of a canonical issue (newspaper or broadcast).",
    "title": "Issue",
    "type": "object",
    "properties": {
        "id": {
            "type": "string",
            "description": "Canonical ID of the newspaper or radio broadcast issue (e.g. GDL-1900-01-02-a, or SOC_CJ-1940-07-22-a)",
            "pattern": "^[A-Za-z][A-Za-z0-9_]*-\\d{4}-\\d{2}-\\d{2}-[a-z]{1,2}$"
        },
        "cdt": {
            "type": "string",
            "description": "Creation date timestamp (of the JSON file)."
        },
        "ts": {
            "type": "string",
            "description": "Creation date timestamp (in '%Y-%m-%dT%H:%M:%SZ' format). If consolidated==True, this is the consolidated timestamp (the original creation timestamp can be found in consolidated_timestamp_original); otherwise it is the original creation timestamp.",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
        },
        "st": {
            "type": "string",
            "description": "Type of media source. Should be a value the impresso-essentials.utils SourceType enum.",
            "enum": [
                "newspaper",
                "radio_broadcast",
                "radio_magazine",
                "radio_schedule",
                "monograph",
                "encyclopedia"
            ]
        },
        "sm": {
            "type": "string",
            "description": "Source medium, format in which the media was originally produced. If `tp == radio_broadcast`, this is typically `typescript` or `audio`.",
            "enum": [
                "print",
                "typescript",
                "audio"
            ]
        },
        "consolidated": {
            "description": "True if this issue is consolidated, and contains additional language identification and ocrqa information.",
            "type": "boolean"
        },
        "consolidated_ts_original": {
            "type": "string",
            "description": "Creation date timestamp (in '%Y-%m-%dT%H:%M:%SZ' format) of the original issue which was consolidated into this object. Only defined if `consolidated==True`.",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
        },
        "media_title_variant": {
            "type": "string",
            "minLength": 1,
            "description": "Variant title of the media title this CI is from (mainly in the case of BL newspapers). The field is present only when a meaningful variant title is available."
        },
        "olr": {
            "description": "True if optical layout recognition was applied to the issue/bulletin this content item originates from.",
            "type": "boolean"
        },
        "i": {
            "type": "array",
            "description": "The content item(s) contained in the newspaper/radio_broadcast issue.",
            "items": {
                "type": "object",
                "description": "A content item (e.g. article, advertisement, radio broadcast, etc.)",
                "properties": {
                    "m": {
                        "description": "Metadata about the content item.",
                        "$ref": "#/$defs/metadata"
                    },
                    "c": {
                        "type": "array",
                        "description": "Coordinates (xywh format or [HPOS, VPOS, WIDTH, HEIGHT]) of image-region corresponding to the content-item depending on its type (if `tp == image`).",
                        "minItems": 4,
                        "items": {
                            "type": "integer"
                        }
                    },
                    "l": {
                        "type": "object",
                        "description": "Legacy sections or components of the content item in the original OCR/OLR. They are meant to enable the reassignation of Impresso CIs (and enrichments) to the original OCR/OLR files.",
                        "properties": {
                            "id": {
                                "type": [
                                    "string",
                                    "array"
                                ],
                                "description": "ID of the sections or components used to compose the CI in the original OCR/OLR files."
                            },
                            "parts": {
                                "type": "array",
                                "description": "List of parts of the given section or components. Exact contents can vary, will typically be composed of the metadata at disposal in the OCR/OLR.",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "comp_role": {
                                            "type": [
                                                "null",
                                                "string"
                                            ],
                                            "description": "Role of the component part (eg. heading, body, etc)."
                                        },
                                        "comp_id": {
                                            "type": [
                                                "string",
                                                "array"
                                            ],
                                            "description": "ID of the part."
                                        },
                                        "comp_fileid": {
                                            "type": [
                                                "string",
                                                "array"
                                            ],
                                            "description": "ID of the ALTO file the component comes from."
                                        },
                                        "comp_page_no": {
                                            "type": [
                                                "integer",
                                                "array"
                                            ],
                                            "description": "Page number of the component."
                                        }
                                    }
                                }
                            },
                            "source": {
                                "type": [
                                    "string",
                                    "array"
                                ],
                                "description": "Source image or OCR/OLR file name."
                            }
                        }
                    },
                    "pOf": {
                        "type": "string",
                        "description": "Article/content-item to which the image is attached (if `tp == image`)."
                    }
                }
            },
            "required": [
                "m"
            ]
        },
        "s": {
            "description": "The text style as defined in the OCR output. \nEach style consists of:\n - a name (`id`)\n - a type-face (`f`)\n - a font-size (`fs`)\n - a color (`rgb`).",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "rgb": {
                        "type": "array",
                        "description": "Color of the text (in RGB).",
                        "items": {
                            "type": "integer"
                        },
                        "minItems": 3
                    },
                    "f": {
                        "type": "string",
                        "description": "Font name"
                    },
                    "fs": {
                        "type": "number",
                        "description": "Font size"
                    },
                    "id": {
                        "type": "integer",
                        "description": "Local ID of the style"
                    }
                },
                "required": [
                    "id"
                ]
            }
        },
        "pp": {
            "type": "array",
            "description": "Canonical IDs of pages in the issue, without file extension (e.g. GDL-1900-01-02-a-p0004). In the case `sm` is in [`print`, `typescript`].",
            "items": {
                "type": "string",
                "pattern": "^[A-Za-z][A-Za-z0-9_]*-\\d{4}-\\d{2}-\\d{2}-[a-z]{1,2}-p[0-9]{4}$"
            }
        },
        "rr": {
            "type": "array",
            "description": "Canonical ID of audio record of the issue (in list for consistency), without file extension (e.g. INA-1900-01-02-a-r0004). In the case `sm`==`audio`.",
            "items": {
                "type": "string",
                "pattern": "^[A-Za-z][A-Za-z0-9_]*-\\d{4}-\\d{2}-\\d{2}-[a-z]{1,3}-r[0-9]{4}$"
            }
        },
        "n": {
            "type": [
                "string",
                "array"
            ],
            "description": "Notes."
        },
        "iiif_manifest_uri": {
            "type": "string",
            "minLength": 1,
            "description": "URI for the issue's manifest in the IIIF Presentation API. The field is present only when a meaningful URI is available."
        },
        "rc": {
            "type": "string",
            "minLength": 1,
            "description": "Radio channel, if applicable (st=='radio_broadcast'). The field is present only when a meaningful value is available."
        },
        "rp": {
            "type": "string",
            "minLength": 1,
            "description": "Radio program if applicable (st=='radio_broadcast'). The field is present only when a meaningful program name is available."
        }
    },
    "$defs": {
        "metadata": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Content item ID (e.g. `GDL-1900-01-02-a-i0001`).",
                    "pattern": "^[A-Za-z][A-Za-z0-9_]*-\\d{4}-\\d{2}-\\d{2}-[a-z]{1,2}-i[0-9]{4}$"
                },
                "lg": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Language of the content item."
                },
                "l": {
                    "type": "string",
                    "description": "Language of the content item (deprecated)."
                },
                "consolidated_reocr_applied": {
                    "type": "boolean",
                    "description": "True if the CI's text went through the re-OCRisation process. Only defined if `consolidated==True`."
                },
                "consolidated_reocr_run_id": {
                    "type": "string",
                    "description": "Run ID corresponding to the re-OCR process. Only defined if `consolidated==True` and `consolidated_re_ocr_applied==True`."
                },
                "consolidated_reocr_model_id": {
                    "type": "string",
                    "description": "Model ID or name corresponding to the re-OCR process. Only defined if `consolidated==True` and `consolidated_re_ocr_applied==True`."
                },
                "consolidated_ocrqa": {
                    "anyOf": [
                        {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "description": "Estimated OCR quality, between 0 and 1. May be null if there is no text or not enough text to compute an estimate. Only defined if `consolidated==True`."
                },
                "consolidated_char_len": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "minimum": 0,
                    "description": "Character count of the consolidated text for the content item. May be null if there is no text. Only defined if `consolidated==True`."
                },
                "lg_original": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Language of the content item in the original OCR/OLR. Only defined if `consolidated==True`."
                },
                "consolidated_lg": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "oneOf": [
                        {
                            "title": "null",
                            "type": "null"
                        },
                        {
                            "$ref": "#/$defs/langISO639Type"
                        }
                    ],
                    "description": "Computed language of the content item. Only defined if `consolidated==True`."
                },
                "consolidated_langident_run_id": {
                    "type": "string",
                    "description": "Run ID corresponding to the lang ID process used to obtain the `consolidated_language` value. Only defined if `consolidated==True`."
                },
                "pp": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    },
                    "description": "Page numbers over which the content item spans, in the case `sm` is in [`print`, `typescript`]."
                },
                "rr": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    },
                    "description": "Record numbers over which the content item spans, in the case `sm` is `audio`."
                },
                "t": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Title of the content item. The field is present only when a meaningful title is available."
                },
                "tp": {
                    "type": "string",
                    "description": "Type of the content item. The field is present only when a meaningful type is available.",
                    "enum": [
                        "article",
                        "ad",
                        "image",
                        "table",
                        "death_notice",
                        "weather",
                        "page",
                        "radio_bulletin",
                        "radio_broadcast_episode",
                        "chronicle"
                    ]
                },
                "iiif_link": {
                    "type": "string",
                    "minLength": 1,
                    "description": "IIIF image link, depending on content item type (if `tp == image`). The field is present only when a meaningful link is available. It should follow the format: '{scheme}://{server}/{prefix}/{identifier}/info.json'."
                },
                "ro": {
                    "type": "integer",
                    "description": "Reading order index of the content item, for the table of contents view on the interface. If not defined, the CI number (after 'i' in the ID) should be used."
                },
                "speakers": {
                    "type": "array",
                    "description": "List of speakers (names or IDs based on availabilities) within boradcast.",
                    "items": {
                        "type": [
                            "object",
                            "string"
                        ]
                    }
                },
                "var_t": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Deprecated, replaced by `var_alias_title` at issue's top-level. Variant title of the media title this CI is from (only in the case of BL newspapers). The field is present only when a meaningful variant title is available."
                },
                "archival_note": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Plaintext archival note or description concerning the content item. The field is present only when a meaningful note is available."
                }
            },
            "required": [
                "id",
                "tp"
            ],
            "oneOf": [
                {
                    "required": [
                        "pp"
                    ]
                },
                {
                    "required": [
                        "rr"
                    ]
                }
            ],
            "dependentRequired": {
                "consolidated_reocr_run_id": [
                    "consolidated_reocr_applied",
                    "consolidated_ocrqa",
                    "consolidated_char_len"
                ],
                "consolidated_lg": [
                    "consolidated_langident_run_id"
                ]
            }
        },
        "langISO639Type": {
            "type": "string",
            "title": "langISO639Type",
            "description": "Two- or three-letter ISO language abbreviation, cf. https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes or https://en.wikipedia.org/wiki/List_of_ISO_639-3_codes",
            "pattern": "^[a-z]{2,3}$"
        }
    },
    "required": [
        "id",
        "i"
    ],
    "dependentRequired": {
        "sm": [
            "st"
        ],
        "st": [
            "sm"
        ]
    },
    "allOf": [
        {
            "anyOf": [
                {
                    "required": [
                        "ts"
                    ]
                },
                {
                    "required": [
                        "cdt"
                    ]
                }
            ]
        },
        {
            "if": {
                "properties": {
                    "sm": {
                        "oneOf": [
                            {
                                "const": "typescript"
                            },
                            {
                                "const": "print"
                            }
                        ]
                    }
                }
            },
            "then": {
                "required": [
                    "pp"
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "sm": {
                        "const": "audio"
                    }
                },
                "then": {
                    "required": [
                        "rr"
                    ]
                }
            }
        },
        {
            "if": {
                "properties": {
                    "sm": {
                        "const": "print"
                    }
                }
            },
            "then": {
                "required": [
                    "olr"
                ]
            }
        }
    ]
}